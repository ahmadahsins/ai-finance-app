
---

# ğŸ“± Tech Spec: AI-Powered Finance Tracker

## 1. Project Overview

Aplikasi pencatat keuangan berbasis mobile (Android/iOS) dengan pendekatan _Single Wallet_. Fitur utamanya adalah integrasi **Generative AI (Gemini)** yang memungkinkan pengguna mencatat transaksi melalui teks natural, suara, atau foto struk, serta antarmuka (UI) yang _gamified_ ala Duolingo.

- **Platform:** Flutter (Android & iOS).
- **Backend:** Firebase (Serverless).
- **State Management:** Riverpod (dengan Code Generation).
- **AI Engine:** Firebase Vertex AI (Gemini).

---

## 2. Architecture Design

Kita akan menggunakan **Riverpod Architecture** dengan pendekatan _Feature-First_ agar kode rapi dan mudah di-_maintain_.

### Layering Concept:

1. **Presentation Layer (UI):** Widgets & Screens. Hanya berisi logika tampilan.
2. **Controller Layer (Application Logic):** Menggunakan `AsyncNotifier` (Riverpod). Menghubungkan UI dengan Repository.
3. **Repository Layer (Data Logic):** Berinteraksi langsung dengan Firebase. Mengubah data mentah menjadi Model.
4. **Data Source:** Firebase SDK (Firestore, Auth, Vertex AI).

---

## 3. Tech Stack & Dependencies (`pubspec.yaml`)

Berikut adalah _package_ vital yang harus kamu install:

### Core & UI

- `flutter_riverpod` & `riverpod_annotation`: State management.
- `go_router`: Routing/Navigasi antar halaman.
- `google_fonts`: Tipografi (pilih font bulat seperti _Nunito_ atau _Varela Round_).
- `intl`: Formatting mata uang (Rp) dan tanggal.
- `fl_chart`: Untuk membuat grafik di masa depan.
- `flutter_svg`: Render icon SVG (jika perlu).

### Backend & Firebase

- `firebase_core`: Wajib.
- `firebase_auth`: Google Sign-In.
- `google_sign_in`: Helper untuk auth Google.
- `cloud_firestore`: Database.
- `firebase_vertexai`: SDK resmi Gemini untuk Flutter (AI Logic).

### Utilities & AI Input

- `uuid`: Generate ID unik (jika perlu manual).
- `image_picker`: Ambil foto struk dari kamera/galeri.
- `speech_to_text`: Konversi suara user menjadi teks sebelum dikirim ke AI.
- `json_annotation`: Untuk serialisasi JSON model.

---

## 4. Database Schema (Cloud Firestore)

Karena kita menggunakan **Single Wallet**, skemanya cukup sederhana.

### A. Collection: `users`

Menyimpan profil dasar.

- `uid` (String): Document ID (dari Auth).
- `email` (String).
- `displayName` (String).
- `photoUrl` (String).
- `createdAt` (Timestamp).

### B. Sub-Collection: `users/{uid}/transactions`

Ini tempat semua data keuangan disimpan.

- `id` (String): Document ID.
- `amount` (Number/Double): Nominal (misal: `50000`).
- `type` (String): Enum `['EXPENSE', 'INCOME']`.
- `category` (String): Misal "Food", "Transport", "Salary".
- `description` (String): Catatan opsional (misal: "Nasi Goreng").
- `date` (Timestamp): Waktu transaksi.
- `isAutoGenerated` (Boolean): `true` jika dibuat oleh AI.
- `receiptUrl` (String, Optional): Link foto struk jika ada.

---

## 5. AI Implementation Logic (The "Brain")

### Model Config

Gunakan **Gemini 1.5 Flash** (lebih cepat dan hemat biaya untuk tugas ekstraksi data).

### System Instruction (Prompt Engineering)

Kamu harus menanamkan instruksi ini di code Flutter-mu agar AI konsisten mengeluarkan output JSON, bukan teks ngobrol.

> "You are a helpful financial assistant API. Your goal is to extract financial transaction details from the user's input (text or image).
> **Rules:**
>
> 1. Always output ONLY valid JSON. No markdown formatting, no conversational filler.
> 2. The JSON structure must be:
>    `{ "amount": number, "type": "EXPENSE" | "INCOME", "category": string, "description": string, "date": "YYYY-MM-DD" }`
> 3. If the input is unclear, make a best guess for 'category'.
> 4. Default to 'EXPENSE' if not specified.
> 5. If specific date is not mentioned, use today's date."

### Flow AI di Aplikasi:

1. **User Input:** Teks / Gambar Struk / Suara (diubah jadi teks).
2. **Flutter App:** Mengirim prompt + input ke `FirebaseVertexAI`.
3. **AI Response:** Menerima String JSON.
4. **Parsing:** App mengubah JSON menjadi Object `Transaction`.
5. **User Review:** Tampilkan UI kartu transaksi (Draft).
6. **Save:** User tekan "Save", data masuk Firestore.

---

## 6. Folder Structure (Feature-First)

Struktur folder yang rapi memudahkan pengembangan jangka panjang.

```text
lib/
â”œâ”€â”€ main.dart
â”œâ”€â”€ app.dart (Theme setup, Routing config)
â”œâ”€â”€ firebase_options.dart (Auto-generated)
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ constants/          # Warna (Lime Green), Strings, Style
â”‚   â”œâ”€â”€ utils/              # Helper (Format Rupiah, Date Formatter)
â”‚   â”œâ”€â”€ common_widgets/     # Tombol, Input Field Custom (Reusable)
â”‚   â”‚
â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ data/       # AuthRepository
â”‚   â”‚   â”‚   â”œâ”€â”€ presentation/ # LoginScreen
â”‚   â”‚   â”‚   â””â”€â”€ application/ # AuthController
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ dashboard/      # Home Screen & Summary Logic
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ transactions/
â”‚   â”‚   â”‚   â”œâ”€â”€ domain/     # TransactionModel (Class)
â”‚   â”‚   â”‚   â”œâ”€â”€ data/       # TransactionRepository (CRUD Firestore)
â”‚   â”‚   â”‚   â”œâ”€â”€ presentation/ # HistoryScreen, AddTransactionScreen
â”‚   â”‚   â”‚   â””â”€â”€ application/ # TransactionController (Add/Delete/Edit)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ai_chat/        # Fitur AI
â”‚   â”‚       â”œâ”€â”€ data/       # AIService (Vertex AI integration)
â”‚   â”‚       â”œâ”€â”€ presentation/ # ChatScreen
â”‚   â”‚       â””â”€â”€ application/ # ChatController

```

---

## 7. Security Rules (Firestore)

Pasang aturan ini di Firebase Console untuk keamanan data user.

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function
    function isOwner(userId) {
      return request.auth != null && request.auth.uid == userId;
    }

    // Rules for User Collection
    match /users/{userId} {
      allow read, write: if isOwner(userId);

      // Rules for Transactions Sub-collection
      match /transactions/{transactionId} {
        allow read, write: if isOwner(userId);
      }
    }
  }
}

```

---

## 8. Development Roadmap (Step-by-Step)

Untuk memulainya, ikuti urutan pengerjaan ini agar tidak pusing:

1. **Phase 0: Setup**

- `flutter create finance_ai_app`
- Setup Firebase Project (via FlutterFire CLI).
- Install dependencies.
- Setup Theme (Colors, Fonts) sesuai desain Duolingo.

2. **Phase 1: Authentication & Layout**

- Buat Login Screen.
- Implementasi Google Sign-In.
- Buat Bottom Navigation Bar (Scaffold utama).

3. **Phase 2: CRUD Basics (Manual Input)**

- Buat Model `Transaction`.
- Buat Repository Firestore.
- Buat Screen "Manual Input" (Tab Tengah).
- Pastikan data bisa tersimpan dan muncul di Home Dashboard.

4. **Phase 3: AI Integration (The Magic)**

- Setup Firebase Vertex AI.
- Buat Chat Screen UI.
- Implementasi logika: Input Teks -> AI -> JSON -> Transaction Object.
- Implementasi Image Input (Struk).

5. **Phase 4: Polish**

- Tambahkan _loading state_ & _error handling_.
- Perhalus animasi.
- Testing dengan data asli.

---
